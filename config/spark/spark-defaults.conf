# Spark Configuration for Iceberg and S3 (MinIO)
# PATH: config/spark/spark-defaults.conf

# Iceberg Configuration
spark.sql.extensions                    org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.spark_catalog         org.apache.iceberg.spark.SparkSessionCatalog
spark.sql.catalog.spark_catalog.type    hive
spark.sql.catalog.iceberg               org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.iceberg.type          hive
spark.sql.catalog.iceberg.uri           thrift://hive-metastore:9083
spark.sql.catalog.iceberg.warehouse     s3a://warehouse/

# S3A Configuration for MinIO
spark.hadoop.fs.s3a.endpoint           http://minio:9000
spark.hadoop.fs.s3a.access.key         admin
spark.hadoop.fs.s3a.secret.key         password123
spark.hadoop.fs.s3a.path.style.access  true
spark.hadoop.fs.s3a.impl               org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.connection.ssl.enabled false
spark.hadoop.fs.s3a.attempts.maximum   3
spark.hadoop.fs.s3a.connection.establish.timeout 5000
spark.hadoop.fs.s3a.connection.timeout 10000

# Hive Metastore Configuration
spark.sql.catalogImplementation        hive
spark.hadoop.hive.metastore.uris       thrift://hive-metastore:9083

# Performance Optimizations
spark.serializer                       org.apache.spark.serializer.KryoSerializer
spark.sql.adaptive.enabled             true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.adaptive.skewJoin.enabled    true

# Iceberg Specific Settings
spark.sql.iceberg.handle-timestamp-without-timezone true
spark.sql.iceberg.check-nullability    false
spark.sql.iceberg.check-ordering       false

# JARs - Iceberg runtime for Spark 3.5
spark.jars.packages                     org.apache.iceberg:iceberg-spark-runtime-3.5_2.12:1.4.3,org.apache.hadoop:hadoop-aws:3.3.4

# Driver and Executor Configuration
spark.driver.memory                     1g
spark.executor.memory                   1g
spark.executor.cores                    1
spark.executor.instances                2